# =============================================
# DOCKER KONFIGURACIJA
# =============================================
# Koristi se kada se aplikacija pokrece u Docker-u
# Aktivira se sa: SPRING_PROFILES_ACTIVE=docker
# =============================================

spring.application.name=jutjubic

# Port na kojem aplikacija slusa (unutar kontejnera)
server.port=8080

# =========================================
# REPLIKA IDENTIFIKACIJA
# =========================================
# Ove vrednosti se prepisuju iz environment varijabli
# definisanih u docker-compose.yml
# =========================================
replica.id=${REPLICA_ID:docker_replica}
replica.table.suffix=shared

# =========================================
# BAZA PODATAKA
# =========================================
# U Docker-u, hostname je ime servisa (postgres)
# a ne localhost
# =========================================
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres:5432/jutjubic}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:super}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hibernate podesavanja
# create-drop = bri≈°e i ponovo kreira tabele pri svakom pokretanju
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Inicijalizacija podataka
spring.sql.init.mode=always
spring.jpa.defer-datasource-initialization=true

# =========================================
# CONNECTION POOL
# =========================================
# HikariCP podesavanja za bolju otpornost
# na gubitak konekcije prema bazi
# =========================================
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
# Validacija konekcije pre upotrebe
spring.datasource.hikari.connection-test-query=SELECT 1

# =========================================
# CACHE
# =========================================
spring.cache.type=jcache
spring.cache.jcache.config=classpath:ehcache.xml

# =========================================
# ACTUATOR - Health Check
# =========================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.health.db.enabled=true

# =========================================
# LOGGING
# =========================================
logging.level.org.hibernate.SQL=INFO
logging.level.org.springframework.security=INFO
logging.level.com.jutjubic=INFO

# =========================================
# JWT
# =========================================
jwt.secret=somesecret
jwt.expiration=1800000

# =========================================
# ERROR HANDLING
# =========================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never

# =========================================
# FILE UPLOAD
# =========================================
# U Docker-u, upload direktorijum je /app/uploads
app.upload.dir=/app/uploads
app.upload.thumbs-dir=thumbs
app.upload.videos-dir=videos
app.upload.tmp-dir=tmp
app.upload.timeout-seconds=20

spring.mvc.formcontent.filter.enabled=false
spring.http.multipart.enabled=true
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=220MB

# =========================================
# EMAIL (opciono)
# =========================================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=davidtot23@gmail.com
spring.mail.password=spppgxntrvbowjmt
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# =========================================
# INTER-REPLICA KOMUNIKACIJA
# =========================================
# U Docker-u, replike komuniciraju preko Docker DNS imena
replicas.urls=http://app-replica-1:8080,http://app-replica-2:8080
